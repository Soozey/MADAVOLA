openapi: 3.0.3
info:
  title: MADAVOLA API
  version: v1
  description: API contract v1 (spec-first). Certains endpoints sont planifi√©s.
servers:
  - url: /api/v1
tags:
  - name: auth
  - name: actors
  - name: geo
  - name: territories
  - name: lots
  - name: transactions
  - name: payments
  - name: fees
  - name: documents
  - name: inspections
  - name: exports
  - name: reports
  - name: admin
paths:
  /audit:
    get:
      tags: [admin]
      summary: List audit logs
      parameters:
        - in: query
          name: actor_id
          schema: { type: integer }
        - in: query
          name: entity_type
          schema: { type: string }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: #/components/schemas/AuditLog
  /health:
    get:
      tags: [admin]
      summary: Healthcheck
      responses:
        "200":
          description: OK
  /ready:
    get:
      tags: [admin]
      summary: Readiness
      responses:
        "200":
          description: OK
  /auth/login:
    post:
      tags: [auth]
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthTokens"
  /auth/refresh:
    post:
      tags: [auth]
      summary: Refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthTokens"
  /auth/logout:
    post:
      tags: [auth]
      summary: Logout
      responses:
        "204":
          description: No Content
  /auth/me:
    get:
      tags: [auth]
      summary: Current actor profile (enriched with territory and roles)
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ActorProfile"
  /actors:
    post:
      tags: [actors]
      summary: Create actor
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ActorCreate"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Actor"
    get:
      tags: [actors]
      summary: List actors
      parameters:
        - in: query
          name: role
          schema: { type: string }
        - in: query
          name: commune_code
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Actor"
  /actors/{actor_id}:
    get:
      tags: [actors]
      summary: Get actor
      parameters:
        - in: path
          name: actor_id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Actor"
    patch:
      tags: [actors]
      summary: Update actor (sensible)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ActorUpdate"
      responses:
        "200":
          description: OK
  /actors/{actor_id}/roles:
    post:
      tags: [actors]
      summary: Add actor role
      responses:
        "201":
          description: Created
    get:
      tags: [actors]
      summary: List actor roles
      responses:
        "200":
          description: OK
  /territories/import:
    post:
      tags: [territories]
      summary: Import territory Excel
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                version_tag:
                  type: string
                file:
                  type: string
                  format: binary
              required: [version_tag, file]
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TerritoryImportResult"
  /territories/versions:
    get:
      tags: [territories]
      summary: List territory versions
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TerritoryVersion"
  /territories/active:
    get:
      tags: [territories]
      summary: Get active territory version
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/TerritoryVersion
  /territories/versions/{version_tag}:
    get:
      tags: [territories]
      summary: Get territory version
      parameters:
        - in: path
          name: version_tag
          required: true
          schema: { type: string }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/TerritoryVersion
  /territories/regions:
    get:
      tags: [territories]
      summary: List regions
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Region"
  /territories/districts:
    get:
      tags: [territories]
      summary: List districts by region
      parameters:
        - in: query
          name: region_code
          required: true
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/District"
  /territories/communes:
    get:
      tags: [territories]
      summary: List communes by district
      parameters:
        - in: query
          name: district_code
          required: true
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Commune"
  /territories/fokontany:
    get:
      tags: [territories]
      summary: List fokontany by commune
      parameters:
        - in: query
          name: commune_code
          required: true
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Fokontany"
  /geo-points:
    post:
      tags: [geo]
      summary: Create geo point
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GeoPointCreate"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GeoPoint"
  /geo-points/{geo_point_id}:
    get:
      tags: [geo]
      summary: Get geo point
      parameters:
        - in: path
          name: geo_point_id
          required: true
          schema: { type: integer }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/GeoPoint
  /lots:
    post:
      tags: [lots]
      summary: Create lot
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LotCreate"
      responses:
        "201":
          description: Created
    get:
      tags: [lots]
      summary: List lots
      responses:
        "200":
          description: OK
  /lots/{lot_id}/transfer:
    post:
      tags: [lots]
      summary: Transfer lot
      responses:
        "200":
          description: OK
  /lots/consolidate:
    post:
      tags: [lots]
      summary: Consolidate lots
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: #/components/schemas/LotConsolidate
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                $ref: #/components/schemas/Lot
  /lots/{lot_id}/split:
    post:
      tags: [lots]
      summary: Split lot
      parameters:
        - in: path
          name: lot_id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: #/components/schemas/LotSplit
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: #/components/schemas/Lot
  /ledger:
    get:
      tags: [lots]
      summary: List ledger entries
      parameters:
        - in: query
          name: actor_id
          schema: { type: integer }
        - in: query
          name: lot_id
          schema: { type: integer }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: #/components/schemas/LedgerEntry
  /ledger/balance:
    get:
      tags: [lots]
      summary: Ledger balance
      parameters:
        - in: query
          name: actor_id
          schema: { type: integer }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: #/components/schemas/LedgerBalance
  /documents/{document_id}:
    get:
      tags: [documents]
      summary: Get document
      parameters:
        - in: path
          name: document_id
          required: true
          schema: { type: integer }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/Document
  /transactions:
    get:
      tags: [transactions]
      summary: List transactions
      parameters:
        - in: query
          name: seller_actor_id
          schema: { type: integer }
        - in: query
          name: buyer_actor_id
          schema: { type: integer }
        - in: query
          name: status
          schema: { type: string }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: #/components/schemas/Transaction
    post:
      tags: [transactions]
      summary: Create transaction
      x-implementation-status: planned
      responses:
        "201":
          description: Created
  /transactions/{transaction_id}:
    get:
      tags: [transactions]
      summary: Get transaction
      parameters:
        - in: path
          name: transaction_id
          required: true
          schema: { type: integer }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/TransactionDetail
  /transactions/{transaction_id}/payments:
    get:
      tags: [transactions]
      summary: List payments for transaction
      parameters:
        - in: path
          name: transaction_id
          required: true
          schema: { type: integer }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: #/components/schemas/TransactionPayment
  /transactions/{transaction_id}/initiate-payment:
    post:
      tags: [transactions]
      summary: Initiate payment for transaction
      parameters:
        - in: path
          name: transaction_id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: #/components/schemas/TransactionPaymentInitiate
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                $ref: #/components/schemas/TransactionPayment
  /payments:
    get:
      tags: [payments]
      summary: List payments
      parameters:
        - in: query
          name: payer_actor_id
          schema: { type: integer }
        - in: query
          name: payee_actor_id
          schema: { type: integer }
        - in: query
          name: status
          schema: { type: string }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: #/components/schemas/PaymentRequest
  /payments/initiate:
    post:
      tags: [payments]
      summary: Initiate payment
      x-implementation-status: planned
      responses:
        "200":
          description: OK
  /payments/webhooks/{provider}:
    post:
      tags: [payments]
      summary: Provider webhook
      x-implementation-status: planned
      parameters:
        - in: path
          name: provider
          required: true
          schema: { type: string }
      responses:
        "200":
          description: OK
  /fees:
  /fees/{fee_id}:
    get:
      tags: [fees]
      summary: Get fee
      parameters:
        - in: path
          name: fee_id
          required: true
          schema: { type: integer }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/Fee

    post:
      tags: [fees]
      summary: Create fee
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: #/components/schemas/FeeCreate
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                $ref: #/components/schemas/Fee
    get:
      tags: [fees]
      summary: List fees
      parameters:
        - in: query
          name: actor_id
          schema: { type: integer }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: #/components/schemas/Fee
    patch:
      tags: [payments]
      summary: Update payment provider
      parameters:
        - in: path
          name: provider_id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: #/components/schemas/PaymentProviderUpdate
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/PaymentProvider
  /payment-providers:
    post:
      tags: [payments]
      summary: Create payment provider
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: #/components/schemas/PaymentProviderCreate
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                $ref: #/components/schemas/PaymentProvider
    get:
      tags: [payments]
      summary: List payment providers
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: #/components/schemas/PaymentProvider
  /payment-providers/{provider_id}:
    patch:
      tags: [payments]
      summary: Update payment provider
      parameters:
        - in: path
          name: provider_id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: #/components/schemas/PaymentProviderUpdate
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/PaymentProvider
  /payments/{payment_id}:
    get:
      tags: [payments]
      summary: Get payment
      parameters:
        - in: path
          name: payment_id
          required: true
          schema: { type: integer }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/PaymentRequest
  /payments/status/{external_ref}:
    get:
      tags: [payments]
      summary: Payment status
      x-implementation-status: planned
      parameters:
        - in: path
          name: external_ref
          required: true
          schema: { type: string }
      responses:
        "200":
          description: OK
  /invoices:
    get:
      tags: [documents]
      summary: List invoices
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: #/components/schemas/Invoice
  /invoices/{invoice_id}:
    get:
      tags: [documents]
      summary: Get invoice
      parameters:
        - in: path
          name: invoice_id
          required: true
          schema: { type: integer }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/Invoice
  /documents:
    post:
      tags: [documents]
      summary: Upload document
      x-implementation-status: planned
      responses:
        "201":
          description: Created
  /reports/commune:
    get:
      tags: [reports]
      summary: Commune report
      parameters:
        - in: query
          name: commune_id
          required: true
          schema: { type: integer }
        - in: query
          name: date_from
          schema: { type: string, format: date }
        - in: query
          name: date_to
          schema: { type: string, format: date }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/CommuneReport
  /reports/actor:
    get:
      tags: [reports]
      summary: Actor report
      parameters:
        - in: query
          name: actor_id
          required: true
          schema: { type: integer }
        - in: query
          name: date_from
          schema: { type: string, format: date }
        - in: query
          name: date_to
          schema: { type: string, format: date }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/ActorReport
  /reports/national:
    get:
      tags: [reports]
      summary: National report
      parameters:
        - in: query
          name: date_from
          schema: { type: string, format: date }
        - in: query
          name: date_to
          schema: { type: string, format: date }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: #/components/schemas/NationalReport
  /inspections:
    post:
      tags: [inspections]
      summary: Create inspection
      x-implementation-status: planned
      responses:
        "201":
          description: Created
  /exports:
    post:
      tags: [exports]
      summary: Create export dossier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExportCreate"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Export"
    get:
      tags: [exports]
      summary: List export dossiers
      parameters:
        - in: query
          name: status
          schema: { type: string }
        - in: query
          name: date_from
          schema: { type: string, format: date }
        - in: query
          name: date_to
          schema: { type: string, format: date }
        - in: query
          name: created_by_actor_id
          schema: { type: integer }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Export"
  /exports/{export_id}:
    get:
      tags: [exports]
      summary: Get export dossier
      parameters:
        - in: path
          name: export_id
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Export"
  /exports/{export_id}/status:
    patch:
      tags: [exports]
      summary: Update export status
      parameters:
        - in: path
          name: export_id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExportStatusUpdate"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Export"
  /exports/{export_id}/lots:
    post:
      tags: [exports]
      summary: Link lots to export
      parameters:
        - in: path
          name: export_id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/ExportLotLink"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Export"
  /admin/config:
    post:
      tags: [admin]
      summary: Create system config
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SystemConfigCreate"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SystemConfig"
    get:
      tags: [admin]
      summary: List system configs
      parameters:
        - in: query
          name: key
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SystemConfig"
  /admin/config/{config_id}:
    get:
      tags: [admin]
      summary: Get system config
      parameters:
        - in: path
          name: config_id
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SystemConfig"
    patch:
      tags: [admin]
      summary: Update system config
      parameters:
        - in: path
          name: config_id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SystemConfigUpdate"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SystemConfig"
    delete:
      tags: [admin]
      summary: Delete system config
      parameters:
        - in: path
          name: config_id
          required: true
          schema: { type: integer }
      responses:
        "204":
          description: No Content
  /admin/actors/{actor_id}/roles:
    post:
      tags: [admin]
      summary: Assign role to actor
      parameters:
        - in: path
          name: actor_id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ActorRoleAssign"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ActorRole"
    get:
      tags: [admin]
      summary: List actor roles
      parameters:
        - in: path
          name: actor_id
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ActorRole"
  /admin/roles/{role_id}:
    patch:
      tags: [admin]
      summary: Update actor role
      parameters:
        - in: path
          name: role_id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ActorRoleUpdate"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ActorRole"
    delete:
      tags: [admin]
      summary: Revoke actor role
      parameters:
        - in: path
          name: role_id
          required: true
          schema: { type: integer }
      responses:
        "204":
          description: No Content
components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        message: { type: string }
        details: { type: object }
    AuthTokens:
      type: object
      properties:
        access_token: { type: string }
        refresh_token: { type: string }
    LoginRequest:
      type: object
      properties:
        identifier: { type: string }
        password: { type: string }
      required: [identifier, password]
    RefreshRequest:
      type: object
      properties:
        refresh_token: { type: string }
      required: [refresh_token]
    Actor:
      type: object
      properties:
        id: { type: string }
        type_personne: { type: string }
        nom: { type: string }
        prenoms: { type: string }
        cin: { type: string }
        nif: { type: string }
        stat: { type: string }
        rccm: { type: string }
        telephone: { type: string }
        email: { type: string }
        region_code: { type: string }
        district_code: { type: string }
        commune_code: { type: string }
        fokontany_code: { type: string }
        status: { type: string }
    ActorCreate:
      type: object
      properties:
        type_personne: { type: string }
        nom: { type: string }
        prenoms: { type: string }
        cin: { type: string }
        nif: { type: string }
        stat: { type: string }
        rccm: { type: string }
        telephone: { type: string }
        password: { type: string }
        region_code: { type: string }
        district_code: { type: string }
        commune_code: { type: string }
        fokontany_code: { type: string }
        geo_point_id: { type: integer }
        roles:
          type: array
          items: { type: string }
      required: [type_personne, nom, telephone, password, commune_code, geo_point_id, roles]
    ActorUpdate:
      type: object
      properties:
        status: { type: string }
        justification: { type: string }
    TerritoryInfo:
      type: object
      properties:
        id: { type: integer }
        code: { type: string }
        name: { type: string }
    ActorRoleInfo:
      type: object
      properties:
        id: { type: integer }
        role: { type: string }
        status: { type: string }
        valid_from: { type: string, format: date-time }
        valid_to: { type: string, format: date-time }
    ActorProfile:
      type: object
      properties:
        id: { type: integer }
        type_personne: { type: string }
        nom: { type: string }
        prenoms: { type: string }
        telephone: { type: string }
        email: { type: string }
        status: { type: string }
        cin: { type: string }
        nif: { type: string }
        stat: { type: string }
        rccm: { type: string }
        region:
          $ref: "#/components/schemas/TerritoryInfo"
        district:
          $ref: "#/components/schemas/TerritoryInfo"
        commune:
          $ref: "#/components/schemas/TerritoryInfo"
        fokontany:
          $ref: "#/components/schemas/TerritoryInfo"
        roles:
          type: array
          items:
            $ref: "#/components/schemas/ActorRoleInfo"
        created_at: { type: string, format: date-time }
    Region:
      type: object
      properties:
        code: { type: string }
        name: { type: string }
    District:
      type: object
      properties:
        code: { type: string }
        name: { type: string }
        region_code: { type: string }
    Commune:
      type: object
      properties:
        code: { type: string }
        name: { type: string }
        district_code: { type: string }
        commune_mobile_money_msisdn: { type: string, nullable: true }
    Fokontany:
      type: object
      properties:
        code: { type: string, nullable: true }
        name: { type: string }
        commune_code: { type: string }
    TerritoryVersion:
      type: object
      properties:
        version_tag: { type: string }
        source_filename: { type: string }
        checksum_sha256: { type: string }
        status: { type: string }
        imported_at: { type: string, format: date-time }
        activated_at: { type: string, format: date-time, nullable: true }
    TerritoryImportResult:
      type: object
      properties:
        version_tag: { type: string }
        regions: { type: integer }
        districts: { type: integer }
        communes: { type: integer }
        fokontany: { type: integer }
    LotCreate:
      type: object
      properties:
        filiere: { type: string }
        product_type: { type: string }
        unit: { type: string }
        quantity: { type: number }
        geo_point_id: { type: string }
    GeoPointCreate:
      type: object
      properties:
        lat: { type: number }
        lon: { type: number }
        accuracy_m: { type: integer }
        captured_at: { type: string, format: date-time }
        source: { type: string }
        device_id: { type: string }
      required: [lat, lon, accuracy_m]
    GeoPoint:
      type: object
      properties:
        id: { type: integer }
        lat: { type: number }
        lon: { type: number }
        accuracy_m: { type: integer }
        captured_at: { type: string, format: date-time }
        source: { type: string }
        device_id: { type: string }
    PaymentInitiate:
      type: object
      properties:
        provider_code: { type: string }
        payer_actor_id: { type: integer }
        payee_actor_id: { type: integer }
        amount: { type: number }
        currency: { type: string }
        external_ref: { type: string }
        idempotency_key: { type: string }
      required: [provider_code, payer_actor_id, payee_actor_id, amount, currency]
    PaymentInitiateResponse:
      type: object
      properties:
        payment_request_id: { type: integer }
        payment_id: { type: integer }
        status: { type: string }
        external_ref: { type: string }
    PaymentWebhook:
      type: object
      properties:
        external_ref: { type: string }
        status: { type: string }
      required: [external_ref, status]
    FeeCreate:
      type: object
      properties:
        fee_type: { type: string }
        actor_id: { type: integer }
        commune_id: { type: integer }
        amount: { type: number }
        currency: { type: string }
      required: [fee_type, actor_id, commune_id, amount]
    Fee:
      type: object
      properties:
        id: { type: integer }
        fee_type: { type: string }
        actor_id: { type: integer }
        commune_id: { type: integer }
        amount: { type: number }
        currency: { type: string }
        status: { type: string }
    PaymentProviderCreate:
      type: object
      properties:
        code: { type: string }
        name: { type: string }
        enabled: { type: boolean }
        config_json: { type: string }
      required: [code, name]
    PaymentProviderUpdate:
      type: object
      properties:
        name: { type: string }
        enabled: { type: boolean }
        config_json: { type: string }
    PaymentProvider:
      type: object
      properties:
        id: { type: integer }
        code: { type: string }
        name: { type: string }
        enabled: { type: boolean }
        config_json: { type: string }
    TransactionItemCreate:
      type: object
      properties:
        lot_id: { type: integer, nullable: true }
        quantity: { type: number }
        unit_price: { type: number }
      required: [quantity, unit_price]
    TransactionCreate:
      type: object
      properties:
        seller_actor_id: { type: integer }
        buyer_actor_id: { type: integer }
        currency: { type: string }
        items:
          type: array
          items:
            $ref: #/components/schemas/TransactionItemCreate
      required: [seller_actor_id, buyer_actor_id, currency, items]
    Transaction:
      type: object
      properties:
        id: { type: integer }
        seller_actor_id: { type: integer }
        buyer_actor_id: { type: integer }
        status: { type: string }
        total_amount: { type: number }
        currency: { type: string }
    Invoice:
      type: object
      properties:
        id: { type: integer }
        invoice_number: { type: string }
        transaction_id: { type: integer }
        seller_actor_id: { type: integer }
        buyer_actor_id: { type: integer }
        total_amount: { type: number }
        status: { type: string }
    TransactionPaymentInitiate:
      type: object
      properties:
        provider_code: { type: string }
        external_ref: { type: string }
        idempotency_key: { type: string }
      required: [provider_code]
    TransactionPayment:
      type: object
      properties:
        payment_request_id: { type: integer }
        payment_id: { type: integer }
        status: { type: string }
        external_ref: { type: string }
    Document:
      type: object
      properties:
        id: { type: integer }
        doc_type: { type: string }
        owner_actor_id: { type: integer }
        related_entity_type: { type: string }
        related_entity_id: { type: string }
        storage_path: { type: string }
        original_filename: { type: string }
        sha256: { type: string }
    TransactionItem:
      type: object
      properties:
        id: { type: integer }
        lot_id: { type: integer, nullable: true }
        quantity: { type: number }
        unit_price: { type: number }
        line_amount: { type: number }
    TransactionDetail:
      type: object
      properties:
        id: { type: integer }
        seller_actor_id: { type: integer }
        buyer_actor_id: { type: integer }
        status: { type: string }
        total_amount: { type: number }
        currency: { type: string }
        items:
          type: array
          items:
            $ref: #/components/schemas/TransactionItem
    PaymentRequest:
      type: object
      properties:
        id: { type: integer }
        provider_id: { type: integer }
        payer_actor_id: { type: integer }
        payee_actor_id: { type: integer }
        fee_id: { type: integer, nullable: true }
        transaction_id: { type: integer, nullable: true }
        amount: { type: number }
        currency: { type: string }
        status: { type: string }
        external_ref: { type: string }
    AuditLog:
      type: object
      properties:
        id: { type: integer }
        actor_id: { type: integer, nullable: true }
        action: { type: string }
        entity_type: { type: string }
        entity_id: { type: string }
        justification: { type: string }
        meta_json: { type: string }
        created_at: { type: string, format: date-time }
    Lot:
      type: object
      properties:
        id: { type: integer }
        filiere: { type: string }
        product_type: { type: string }
        unit: { type: string }
        quantity: { type: number }
        declared_at: { type: string, format: date-time }
        declared_by_actor_id: { type: integer }
        current_owner_actor_id: { type: integer }
        status: { type: string }
        declare_geo_point_id: { type: integer }
    LotCreate:
      type: object
      properties:
        filiere: { type: string }
        product_type: { type: string }
        unit: { type: string }
        quantity: { type: number }
        declare_geo_point_id: { type: integer }
        declared_by_actor_id: { type: integer }
      required: [product_type, unit, quantity, declare_geo_point_id, declared_by_actor_id]
    LotTransfer:
      type: object
      properties:
        new_owner_actor_id: { type: integer }
        payment_request_id: { type: integer }
      required: [new_owner_actor_id, payment_request_id]
    LotConsolidate:
      type: object
      properties:
        lot_ids:
          type: array
          items: { type: integer }
        product_type: { type: string }
        unit: { type: string }
        declare_geo_point_id: { type: integer }
      required: [lot_ids, product_type, unit, declare_geo_point_id]
    LotSplit:
      type: object
      properties:
        quantities:
          type: array
          items: { type: number }
      required: [quantities]
    LedgerEntry:
      type: object
      properties:
        id: { type: integer }
        actor_id: { type: integer }
        lot_id: { type: integer }
        movement_type: { type: string }
        quantity_delta: { type: number }
        ref_event_type: { type: string }
        ref_event_id: { type: string }
        created_at: { type: string, format: date-time }
    LedgerBalance:
      type: object
      properties:
        actor_id: { type: integer }
        lot_id: { type: integer }
        quantity: { type: number }
    InspectionCreate:
      type: object
      properties:
        inspected_actor_id: { type: integer }
        inspected_lot_id: { type: integer }
        inspected_invoice_id: { type: integer }
        result: { type: string }
        reason_code: { type: string }
        notes: { type: string }
        geo_point_id: { type: integer }
      required: [result]
    Inspection:
      type: object
      properties:
        id: { type: integer }
        inspector_actor_id: { type: integer }
        inspected_actor_id: { type: integer }
        inspected_lot_id: { type: integer }
        inspected_invoice_id: { type: integer }
        result: { type: string }
        reason_code: { type: string }
        notes: { type: string }
    ViolationCreate:
      type: object
      properties:
        inspection_id: { type: integer }
        violation_type: { type: string }
        legal_basis_ref: { type: string }
      required: [inspection_id, violation_type]
    Violation:
      type: object
      properties:
        id: { type: integer }
        inspection_id: { type: integer }
        violation_type: { type: string }
        legal_basis_ref: { type: string }
        status: { type: string }
    PenaltyCreate:
      type: object
      properties:
        violation_case_id: { type: integer }
        penalty_type: { type: string }
        amount: { type: number }
      required: [violation_case_id, penalty_type]
    Penalty:
      type: object
      properties:
        id: { type: integer }
        violation_case_id: { type: integer }
        penalty_type: { type: string }
        amount: { type: number }
        status: { type: string }
    ExportCreate:
      type: object
      properties:
        destination: { type: string }
        total_weight: { type: number }
    ExportStatusUpdate:
      type: object
      properties:
        status: { type: string }
      required: [status]
    ExportLotLink:
      type: object
      properties:
        lot_id: { type: integer }
        quantity_in_export: { type: number }
      required: [lot_id, quantity_in_export]
    Export:
      type: object
      properties:
        id: { type: integer }
        status: { type: string }
        destination: { type: string }
        total_weight: { type: number }
        created_by_actor_id: { type: integer }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
    SystemConfigCreate:
      type: object
      properties:
        key: { type: string }
        value: { type: string }
        description: { type: string }
      required: [key]
    SystemConfigUpdate:
      type: object
      properties:
        value: { type: string }
        description: { type: string }
    SystemConfig:
      type: object
      properties:
        id: { type: integer }
        key: { type: string }
        value: { type: string }
        description: { type: string }
        updated_by_actor_id: { type: integer }
        updated_at: { type: string, format: date-time }
        created_at: { type: string, format: date-time }
    ActorRoleAssign:
      type: object
      properties:
        role: { type: string }
        valid_from: { type: string, format: date-time }
        valid_to: { type: string, format: date-time }
      required: [role]
    ActorRoleUpdate:
      type: object
      properties:
        status: { type: string }
        valid_from: { type: string, format: date-time }
        valid_to: { type: string, format: date-time }
    ActorRole:
      type: object
      properties:
        id: { type: integer }
        actor_id: { type: integer }
        role: { type: string }
        status: { type: string }
        valid_from: { type: string, format: date-time }
        valid_to: { type: string, format: date-time }
    CommuneReport:
      type: object
      properties:
        commune_id: { type: integer }
        volume_created: { type: number }
        transactions_total: { type: number }
    ActorReport:
      type: object
      properties:
        actor_id: { type: integer }
        volume_created: { type: number }
        transactions_total: { type: number }
    NationalReport:
      type: object
      properties:
        volume_created: { type: number }
        transactions_total: { type: number }
